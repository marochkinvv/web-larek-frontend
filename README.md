# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:

- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:

- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск

Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```

## Сборка

```
npm run build
```

или

```
yarn build
```

## Данные и типы данных, используемые в приложении

Карточка товара

```
interface ICard {
	id: string;
	description: string;
	image: string;
	title: string;
	category: string;
	price: number;
}
```

Заказ

```
interface IOrder {
	address: string;
	email: string;
	tel: string;
	payment: 'online' | 'offline';
	orderState: 'clear' | 'stepOne' | 'stepTwo' | 'success' | 'error';
	checkValidationStepOne(data: Record<keyof TOrderPaymentInfo, string>): boolean;
	checkValidationStepTwo(data: Record<keyof TOrderContactsInfo, string>): boolean;
	setOrderState(): void;
}
```

Каталог товаров

```
interface ICatalog {
	cards: ICard[];
	getCard(cardId: string): ICard;
}
```

Корзина

```
interface ICart {
	cards: TCardCartInfo[];
	getTotalCards(cards: ICard[]): number;
	getTotalPrice(cards: ICard[]): number;
	addCard(card: TCardCartInfo): void;
	deleteCard(cardId: string): void;
	clearCart(): void;
}
```

Данные карточки, используемые в корзине

```
type TCardCartInfo = Pick<ICard, 'id' | 'title' | 'price'>;
```

Данные пользователя, используемые в форме выбора способа оплаты

```
type TOrderPaymentInfo = Pick<IUser, 'payment' | 'address'>;
```

Данные пользователя, используемые в форме заполнения контактных данных

```
type TOrderContactsInfo = Pick<IUser, 'email' | 'tel'>;
```

## Архитектура приложения

Код приложения разделен на слои согласно парадигме MVP:

- слой представления, отвечает за отображение данных на странице,
- слой данных, отвечает за хранение и изменение данных,
- презентер, отвечает за связь представления и данных.

### Базовый код

#### Класс Api

Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.
Методы:

- `get` - выполняет `GET` запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт, переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

#### Класс EventEmitter

Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложений для генерации событий.
Основные методы, реализуемые классом, описаны интерфейсом `IEvents`:

- `on` - подписка на событие,
- `emit` - инициализация события,
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие.

### Слой данных

#### Класс Catalog

Класс отвечает за хранение и логику работы карточек товаров в основном каталоге (например, на Главной странице).\
Конструктор класса принимает инстант брокера событий.\
В полях класса хранятся следующие данные:

- \_cards: ICard[] - массив объектов карточек
- events: IEvents - экземпляр класса `EventEmitter` для инициации событий при изменении данных.

Также класс предоставляет набор методов для взаимодействия с этими данными:

- getCard(cardId: string): ICard - возвращает карточку по её ID

#### Класс Cart

Класс отвечает за хранение и логику работы с данными корзины.\
Конструктор класса принимает инстант брокера событий.\
В полях класса хранятся следующие данные:

- \_cards: TCardCartInfo[] - массив объектов карточек
- events: IEvents - экземпляр класса `EventEmitter` для инициации событий при изменении данных.

Также класс предоставляет набор методов для взаимодействия с этими данными:

- getTotalCards(cards: TCardCartInfo[]): number - получает кол-во карточек в массиве
- getTotalPrice(cards: TCardCartInfo[]): number - получает общую стоимость карточек, находящихся в массиве
- addCard(card: TCardCartInfo): void - добавляет карточку в начало массива
- deleteCard(cardId: string): void - удаляет карточку из массива
- clearCart(): void - очищает массив

#### Класс Order

Класс отвечает за хранение и логику работы с данными заказа.\
Конструктор класса принимает инстант брокера событий.\
В полях класса хранятся следующие данные:

- address: string - Адрес пользователя
- email: string - Емэйл пользователя
- tel: string - Телефон пользователя
- payment: 'online' | 'offline' - способ оплаты заказа
- orderState: 'clear' | 'stepOne' | 'stepTwo' | 'success' - состояние заказа
- events: IEvents - экземпляр класса `EventEmitter` для инициации событий при изменении данных.

Также класс предоставляет набор методов для взаимодействия с этими данными:

- checkValidationStepOne(data: Record<keyof TOrderPaymentInfo, string>): boolean - Проверяет объект с данными пользователя из первого шага оформления заказа на валидность
- checkValidationStepTwo(data: Record<keyof TOrderContactsInfo, string>): boolean - Проверяет объект с данными пользователя из второго шага оформления заказа на валидность
- setOrderState(): void - устанавливает состояние заказа

### Классы представления

Все классы представления отвечают за отображение внутри контейнеров (DOM-элементов), передаваемых в них данных.

#### Класс Modal

Реализует модальное окно. Также предоставляет методы `open` и `close` для управления отображением модального окна. Устанавливает слушатели на клавиатуру для закрытия модального окна по Esc, на клик в оверлэй, на кнопку-крестик для закрытия окна.

- constructor(events: IEvents) - Конструктор принимает экземпляр класса `EventEmitter` для возможности инициации событий.

Поля класса:

- modal: HTMLElement - элемент модального окна
- events: Ievents - брокер событий

#### Класс ModalWithOrderStepOne

Расширяет класс Modal. Предназначен для реализации модального окна первого шага заказа. При сабмите инициирует событие, передавая в него объект с данными из полей ввода формы. При изменении данных в полях ввода инициирует событие изменения данных. Предоставляет методы для отображения ошибок и управления активностью кнопки сохранения. \

Поля класса:

- submitButton: HTMLButtonElement - Кнопка подтверждения
- \_form: HTMLFormElement - Элемент формы
- formName: string - значение атрибута name формы
- paymentButtons: NodeListOf<HTMLButtonElement> - коллекция кнопок формы с выбором способа оплаты
- input: HTMLInputElement - инпут формы с адресом доставки
- error: HTMLElement - элемент для вывода ошибки под полями формы

Методы:

- setValid(isValid: boolean): void - изменяет активность кнопки подтверждения
- getPaymentButtonValue(): string - возвращает значение кнопки способа оплаты, выбранной пользователем
- getInputValue(): string - возвращает данные, введенные пользователем в инпут
- setError(data: { field: string, value: string, validInformation: string }): void - принимает объект с данными для отображения или скрытия текста ошибки под инпутом
- showInputError (field: string, errorMessage: string): void - отображает полученный текст ошибки под указанным полем ввода
- hideInputError (field: string): void - очищает текст ошибки под указанным инпутом
- close(): void - расширяет родительский метод, дополнительно очищая поле ввода и деактивируя кнопку подтверждения
- get form(): HTMLElement - геттер для получения элемента формы

#### Класс ModalWithOrderStepTwo

Расширяет класс Modal. Предназначен для реализации модального окна второго шага заказа. При сабмите инициирует событие, передавая в него объект с данными из полей ввода формы. При изменении данных в полях ввода инициирует событие изменения данных. Предоставляет методы для отображения ошибок и управления активностью кнопки сохранения. \

Поля класса:

- submitButton: HTMLButtonElement - Кнопка подтверждения
- \_form: HTMLFormElement - Элемент формы
- formName: string - значение атрибута name формы
- inputs: NodeListOf<HTMLInputElement> - коллекция всех полей ввода формы
- errors: Record<string, HTMLElement> - объект, хранящий все элементы для вывода ошибок под полями формы с привязкой к атрибуту name инпутов

Методы:

- setValid(isValid: boolean): void - изменяет активность кнопки подтверждения
- getInputValues(): Record<string, string> - возвращает объект с данными из полей формы, где ключ - name инпута, значение - введенные пользователем данные
- setError(data: { field: string, value: string, validInformation: string }): void - принимает объект с данными для отображения или скрытия текста ошибки под инпутом
- showInputError (field: string, errorMessage: string): void - отображает полученный текст ошибки под указанным полем ввода
- hideInputError (field: string): void - очищает текст ошибки под указанным инпутом
- close(): void - расширяет родительский метод, дополнительно очищая поле ввода и деактивируя кнопку подтверждения
- get form(): HTMLElement - геттер для получения элемента формы

#### Класс ModalCart

Расширяет класс Modal.\
Предназначен для реализации модального окна корзины.\
В конструктор принимает контейнер, в котором размещаются карточки, добавленные в корзину.
При сабмите инициирует событие, передавая в него объект с массивом карточек, добавленных в корзину и их общей стоимостью.\
При удалении товаров из корзины инициирует событие изменения данных.\
Предоставляет методы для удаления товаров из корзины, отображения общей суммы товаров в корзине и управления активностью кнопки подтверждения.\
Предоставляет сеттер `container` для полного обновления содержимого.

Поля класса:

- totalPrice: HTMLElement - элемент, отображающий общую стоимость товаров
- submitButton: HTMLButtonElement - кнопка подтверждения

Методы:

- setCard(cardData: ICard): void - заполняет атрибуты элементов карточки данными
- render(): HTMLElement - метод возвращает полностью заполненную карточку с установленными слушателями
- getTotalPrice(): void - возвращает общую стоимость товаров
- setTotalPrice(number): string - заполняет общую стоимость товаров
- getId(): void - возвращает уникальный id карточки
- deleteCard(cardId: string): void - удаляет карточку из корзины

#### Класс CardUI

Отвечает за отображение карточки товара, задавая в карточке данные названия, описания, изображения, цены, категории, иконки корзины и порядкового номера.\
Класс используется для отображения карточек на Главной странице сайта.\
В конструктор передается DOM-элемент темплейта, что позволяет при необходимости формировать карточки разных вариантов верстки.\
Поля класса содержат элементы разметки элементов карточки.\
Конструктор, кроме темплейта принимает экземпляр `EventEmitter` для инициации событий.\

Методы:

- setCard(cardData: ICard): void - заполняет атрибуты элементов карточки данными
- render(): HTMLElement - метод возвращает полностью заполненную карточку с установленными слушателями
- getId(): void - возвращает уникальный id карточки

#### Класс CatalogUI

Отвечает за отображение списка карточек на Главной странице. В конструктор принимает контейнер, в котором размещаются карточки. Предоставляет сеттер `container` для полного обновления содержимого.

#### Класс ModalCard

Расширяет класс Modal.\
Отвечает за отображение модального окна с подробной информацией о карточке товара.\
В конструктор принимает Id карточки, которая будет отображена в модальном окне, темплэйт для верстки карточки, экземпляр `EventEmitter` для инициации событий.\
Предоставляет методы для добавления/удаления товара из корзины, управления активностью кнопки добавления/удаления товара.\
При добавлении/удалении товаров из корзины инициирует событие изменения данных.

Методы:

- setCard(cardData: ICard): void - заполняет атрибуты элементов карточки данными
- render(): HTMLElement - метод возвращает полностью заполненную карточку с установленными слушателями
- getId(): void - возвращает уникальный id карточки

#### Класс ModalOrderSuccess

Расширяет класс Modal.\
Отвечает за отображение модального окна с сообщением об успешно оформленном заказе.\
В конструктор принимает сумму заказа.\
Предоставляет методы для отображения суммы заказа, а также расширяет метод `close`, позволяя сбросить содержимое корзины.

#### Класс CartUI

Отвечает за отображение иконки корзины на Главной странице.\
Принимает в конструктор контейнер - элемент разметки блока корзины, и экземпляр `EventEmitter` для инициации событий.
В полях класса содержатся ссылки на все элементы разметки блока.
Методы:

- setTotalCards(data: number): void - устанавливает значение суммарной стоимости товаров, находящихся в корзине.

### Слой коммуникации

#### Класс AppApi

Принимает в конструктор экземпляр класса `Api` и предоставляет методы, реализующие взаимодействие с бэкендом сервиса.

## Взаимодействие компонентов

Код, описывающий взаимодействие представления и данных между собой, находится в файле `index.ts`, выполняющем роль презентера.\
Взаимодействие осуществляется за счет событий, генерируемых с помощью брокера событий и обработчиков этих событий, описанных в `index.ts`.\
В `index.ts` сначала создаются экземпляры всех необходимых классов, а затем настраивается обработка событий.

_Список всех событий, которые могут генерироваться в системе:_\
_События изменения данных (генерируются классами моделями данных)_

- `order:changed` - изменение данных заказа
- `cards:changed` - изменение массива карточек
- `cart:changed` - изменение данных корзины

_События, возникающие при взаимодействии пользователя с интерфейсом (генерируются классами, отвечающими за представление)_\

- `cart:open` - открытие модального окна корзины
- `cart:submit` - событие, генерируемое при нажатии "оформить" в корзине
- `card:open` - открытие модального окна карточки товара
- `order-step-one:open` - открытие модального окна первого шага оформления заказа
- `order-step-two:open` - открытие модального окна второго шага оформления заказа
- `order-success:open` - открытие модального окна с уведомлением об успешно оформленном заказе
- `add-card:submit` - добавление товара в корзину
- `delete-card:submit` - удаление товара из корзины
- `order-payment:select` - выбор способа доставки
- `order-address:input` - изменение данных адреса доставки
- `order-step-one:submit` - событие, генерируемое при нажатии "далее" в модальном окне первого шага заказа
- `order-step-one:validation` - событие, сообщающее о необходимости валидации формы первого шага заказа
- `order-mail:input` - изменение данных электронной почты
- `order-tel:input` - изменение данных телефона
- `order-step-two:submit` - событие, генерируемое при нажатии "оплатить" в модальном окне второго шага заказа
- `order-step-two:validation` - событие, сообщающее о необходимости валидации формы второго шага заказа
- `order-success:submit` - событие, генерируемое при нажатии "за новыми покупками" в модальном окне успешного заказа
- `order:clear` - очистка данных в заказе, возвращение к начальному состоянию
- `cart:clear` - очистка данных в корзине
