# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:

- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:

- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск

Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```

## Сборка

```
npm run build
```

или

```
yarn build
```

## Данные и типы данных, используемые в приложении

Карточка товара

```
interface ICard {
	id: string;
	description?: string;
	image?: string;
	title: string;
	category?: string;
	price: number;
  isInCart: boolean;
  index?: number;
}
```

Заказ

```
interface IOrder {
	address: string;
	email: string;
	phone: string;
	payment: string;
	checkValidationPayment(data: string): boolean;
  checkValidationAddress(data: string): boolean;
  checkValidationEmail(data: string): boolean;
  checkValidationPhone(data: string): boolean;
}
```

Каталог товаров

```
interface ICatalog {
	_cards: ICard[];
  getCard(cardId: string): ICard | undefined;
}
```

## Архитектура приложения

Код приложения разделен на слои согласно парадигме MVP:

- слой представления, отвечает за отображение данных на странице,
- слой данных, отвечает за хранение и изменение данных,
- презентер, отвечает за связь представления и данных.

### Базовый код

#### Класс Api

Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.
Методы:

- `get` - выполняет `GET` запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт, переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

#### Класс EventEmitter

Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложений для генерации событий.
Основные методы, реализуемые классом, описаны интерфейсом `IEvents`:

- `on` - подписка на событие,
- `emit` - инициализация события,
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие.

### Слой данных

#### Класс CatalogModel

Класс отвечает за хранение и логику работы карточек товаров в основном каталоге (например, на Главной странице).\
Конструктор класса принимает инстант брокера событий.\
В полях класса хранятся следующие данные:

- \_cards: ICard[] - массив объектов карточек
- events: IEvents - экземпляр класса `EventEmitter` для инициации событий при изменении данных.

Также класс предоставляет набор методов для взаимодействия с этими данными:

- setCards(cards: ICard[]) - загружает карточки в каталог
- getCard(cardId: string): ICard - возвращает карточку по её ID
- changeCardState(cardId: string) - изменяет состояние карточки (добавление/удаление в корзину)
- getCatalog() - получает список карточек
- getInCart() - получает список карточек, добавленных в корзину
- getInCartTotal() - получает кол-во карточек, добавленных в корзину
- getInCartTotalPrice(): number - получает общую стоимость карточек, добавленных в корзину
- getCardInCart(cardId: string) - получает карточку из корзины по её id
- getCardIndexInCart(cardId: string): number - получает индекс карточки в корзине
- addCard(card: ICard) - добавляет карточку в список карточек

#### Класс OrderModel

Класс отвечает за хранение и логику работы с данными заказа.\
Конструктор класса принимает инстант брокера событий.\
В полях класса хранятся следующие данные:

- address: string - Адрес пользователя
- email: string - Емэйл пользователя
- phone: string - Телефон пользователя
- payment: string - способ оплаты заказа
- events: IEvents - экземпляр класса `EventEmitter` для инициации событий при изменении данных.

Также класс предоставляет набор методов для взаимодействия с этими данными:

- checkValidationPayment(data: string): boolean - валидирует кнопки выбора способа оплаты
- checkValidationAddress(data: string): boolean - валидирует полученное значение адреса доставки
- checkValidationEmail(data: string): boolean - валидирует полученное значение емэйла
- checkValidationPhone(data: string): boolean - валидирует полученное значение телефона
- setPayment(data: string) - устанавливает значение способа оплаты
- setAddress(data: string) - устанавливает значение адреса доставки
- setEmail(data: string) - устанавливает значение емэйла
- setPhone(data: string) - устанавливает значение телефона
- reset() - сбрасывает все значения

### Классы представления

Все классы представления отвечают за отображение внутри контейнеров (DOM-элементов), передаваемых в них данных.

#### Класс Modal

Реализует модальное окно. Также предоставляет методы `open` и `close` для управления отображением модального окна. Устанавливает слушатели на клавиатуру для закрытия модального окна по Esc, на клик в оверлэй, на кнопку-крестик для закрытия окна.

- constructor(container: HTMLElement, protected events: IEvents) - Конструктор принимает экземпляр класса `EventEmitter` для возможности инициации событий, а также элемент `container`, в котором размещается содержимое модального окна.

Поля класса:

- \_closeButton: HTMLButtonElement - элемент кнопки закрытия модального окна
- \_content: HTMLElement - элемент содержимого модального окна

Методы:

- open() - показывает модальное окно
- close() - скрывает модальное окно
- handleEscUp(evt: KeyboardEvent) - скрывает модальное окно по нажатию Esc
- render(data: IModalData): HTMLElement - отрисовывает содержимое модального окна

#### Класс Order

Предназначен для реализации модального окна первого шага заказа. При сабмите инициирует событие открытия следующего шага оформления заказа. При изменении данных в полях ввода инициирует событие изменения данных. Предоставляет методы для отображения ошибок и управления активностью кнопки сохранения. \

Поля класса:

- cardButton: HTMLButtonElement - Кнопка способа оплаты онлайн
- cashButton: HTMLButtonElement - Кнопка способа оплаты офлайн
- submitButton: HTMLButtonElement - Кнопка перехода к следующему шагу оформления заказа
- addressInput: HTMLInputElement - Инпут для ввода адреса доставки
- errors: HTMLElement - Элемент для вывода ошибки под полями формы

Методы:

- changeSubmitButtonState(data: boolean) - Изменяет активность кнопки сабмита
- setAddressError(data: boolean) - устанавливает текст ошибки
- resetOrder() - сбрасывает все значения и состояния формы

#### Класс Contacts

Предназначен для реализации модального окна второго шага заказа. При сабмите инициирует отправку данных о заказе на сервер. При изменении данных в полях ввода инициирует событие изменения данных. Предоставляет методы для отображения ошибок и управления активностью кнопки сохранения. \

Поля класса:

- phoneInput: HTMLInputElement - Инпут для ввода номера телефона
- phoneErrors: HTMLElement - элемент для вывода ошибки заполнения инпута для ввода номера телефона под полями формы
- emailInput: HTMLInputElement - Инпут для ввода емэйла
- emailErrors: HTMLElement - элемент для вывода ошибки заполнения инпута для ввода емэйла под полями формы
- submitButton: HTMLButtonElement - элемент Кнопки сабмита

Методы:

- setEmailError(data: boolean) - устанавливает текст ошибки для емэйла
- setPhoneError(data: boolean) - устанавливает текст ошибки для телефона
- changeSubmitButtonState(data: boolean) - изменяет активность кнопки сабмита
- resetContacts() - сбрасывает все значения и состояния формы

#### Класс Success

Отвечает за отображение модального окна с сообщением об успешно оформленном заказе.\
В конструктор принимает элемент `container` для отображения содержимого модального окна, а также значение суммы заказа.\
Предоставляет метод для отображения суммы заказа.

#### Класс Cart

Предназначен для реализации модального окна корзины.\
В конструктор принимает контейнер, в котором размещаются карточки, добавленные в корзину.\
При сабмите инициирует событие для перехода к оформлению заказа.\
Содержит сеттеры для загрузки карточек товаров в корзину и отображения общей стоимости товаров.

Поля класса:

- items: HTMLElement[] - элемент, содержащий коллекцию карточек товаров, добавленных в корзину
- totalPrice: number - элмент, отображающий общую стоимость карточек в корзине
- cartButton: HTMLButtonElement - элемент кнопки сабмита

Методы:

- changeButtonState(data: boolean) - изменяет активность кнопки сабмита

#### Класс Card

Родительский класс, отвечающий за отображение карточки товара, задавая в карточке данные названия, описания, изображения, цены, категории, иконки корзины и порядкового номера.\
В конструктор передается DOM-элемент темплейта, что позволяет при необходимости формировать карточки разных вариантов верстки.\
Поля класса содержат элементы разметки элементов карточки.\
Конструктор, кроме темплейта принимает экземпляр `EventEmitter` для инициации событий.\

#### Класс CardCatalogPreview

Расширяет класс `Card`.\
Отвечает за отображение списка карточек на Главной странице. В конструктор принимает контейнер, в котором размещаются карточки. Содержит сеттер `container` для полного обновления содержимого.

#### Класс CardModalPreview

Расширяет класс `Card`.\
Отвечает за отображение карточки в модальном окне с подробной информацией о карточке.\
В конструктор принимает темплэйт для верстки карточки, экземпляр `EventEmitter` для инициации событий.\
Предоставляет сеттеры и методы для установки значений в верстку карточки, управления активностью кнопки добавления/удаления товара.

#### Класс CardInCartPreview

Расширяет класс `Card`.\
Отвечает за отображение карточки в корзине с необходимой информацией о карточке товара.\
В конструктор принимает темплэйт для верстки карточки, экземпляр `EventEmitter` для инициации событий.\
Предоставляет сеттеры для установки значений в верстку карточки, управления активностью кнопки добавления/удаления товара.

#### Класс Page

Отвечает за отображение иконки корзины и каталога карточек на Главной странице.\
Принимает в конструктор контейнер - элемент разметки блока корзины, и экземпляр `EventEmitter` для инициации событий.\
В полях класса содержатся ссылки на все элементы разметки блока.\
Содержит сеттеры для наполнения контейнера карточками товаров, изменения значения счетчика на иконке корзины, а также для блокировки страницы во время отображения модальных окон.

### Слой коммуникации

#### Класс CatalogApi

Расширяет класс `Api` и предоставляет метод для отправки GET-запроса для получения массива карточек товаров.

## Взаимодействие компонентов

Код, описывающий взаимодействие представления и данных между собой, находится в файле `index.ts`, выполняющем роль презентера.\
Взаимодействие осуществляется за счет событий, генерируемых с помощью брокера событий и обработчиков этих событий, описанных в `index.ts`.\
В `index.ts` сначала создаются экземпляры всех необходимых классов, а затем настраивается обработка событий.

_Список всех событий, которые могут генерироваться в системе:_\
_События изменения данных (генерируются классами моделями данных)_

- `order: changed` - изменение данных заказа
- `cards: changed` - изменение массива карточек
- `cart: changed` - изменение данных корзины

_События, возникающие при взаимодействии пользователя с интерфейсом (генерируются классами, отвечающими за представление)_\

- `card: select` - открытие модального окна с подробной информацией о карточке товара
- `card: change-card-state` - изменение состояния карточки (в корзине/не в корзине)
- `cart: open` - открытие модального окна корзины
- `order-delivery: open` - открытие модального окна первого шага оформления заказа
- `order-contacts: open` - открытие модального окна второго шага оформления заказа
- `order-success: open` - открытие модального окна с уведомлением об успешно оформленном заказе
- `order: choose-payment` - выбор способа оплаты
- `order: address-input` - ввод текста в инпут адреса доставки
- `order: correct-payment` - уведомление об успешной валидации способа оплаты
- `order: correct-address` - уведомление об успешной валидации инпута адреса доставки
- `order: incorrect-address` - уведомление об ошибке в инпуте адреса доставки
- `order: input-email` - ввод текста в инпут емэйла
- `order: input-phone` - ввод текста в инпут телефона
- `order: correct-email` - уведомление об успешной валидации инпута емэйла
- `order: correct-phone` - уведомление об успешной валидации инпута телефона
- `order: incorrect-email` - уведомление об ошибке в инпуте емэйла
- `order: incorrect-phone` - уведомление об ошибке в инпуте телефона
- `order: send-post` - отправка данных на сервер и сброс всех значений заказа и корзины
- `success: close` - закрытие модального окна по кнопке в модалке с сообщением об успешном заказе
- `modal: open` - открытие модального окна
- `modal: close` - закрытие модального окна
